<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Upsell 1 - Lourdes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #fff;
      color: #111;
      font-family: 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
      box-sizing: border-box;
      overflow-x: hidden;
    }

    .banner-topo {
      width: 100%;
      background: #ff0000;
      color: #fff;
      font-weight: bold;
      text-align: center;
      padding: 14px 2vw 12px;
      font-size: 1.08rem;
      letter-spacing: 0.5px;
      box-sizing: border-box;
    }

    .video-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 16px 0;
    }

    .video-player {
      width: 100%;
      max-width: 400px;
    }

    .btn-wrapper {
      display: none;                 /* começa escondido; será exibido via JS */
      justify-content: center;
      gap: 16px;
      margin: 28px auto 40px;
      padding: 0 16px;
      max-width: 420px;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-block;
      background-color: #28A745;
      color: #fff;
      font-weight: bold;
      padding: 14px 18px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 1rem;
      min-width: 150px;
      text-align: center;
      line-height: 1.2;
      transition: transform 0.18s ease, opacity 0.18s ease;
      opacity: 0.98;
    }
    .btn:hover { transform: scale(1.03); opacity: 1; }
    .btn-no { background-color: #dc3545; }

    @media (max-width: 600px) {
      .banner-topo { font-size: 0.98rem; padding: 10px 2vw 8px; }
      .btn { width: 100%; }
      .btn-wrapper { gap: 12px; }
    }
  </style>

  <!-- Script Cartpanda -->
  <script src="https://assets.mycartpanda.com/cartx-ecomm-ui-assets/js/libs/ocu-external.js"></script>
  <script>
    new OcuExternal();
  </script>

  <!-- VTurb player será injetado mais abaixo -->
</head>
<body>

  <div class="banner-topo">
    WARNING: Do not close this page or click the "back" button to avoid any potential double charge
  </div>

  <!-- Vídeo centralizado Vturb -->
  <div class="video-wrapper">
    <div class="video-player">
      <vturb-smartplayer id="vid-68d1e8f5cb9a4bf4b899584c" style="display:block; margin:0 auto; width:100%; max-width:400px;"></vturb-smartplayer>
      <script type="text/javascript">
        (function() {
          var s = document.createElement("script");
          s.src = "https://scripts.converteai.net/9d1f4327-1dc5-46ae-8030-267fa8685435/players/68d1e8f5cb9a4bf4b899584c/v4/player.js";
          s.async = true;
          document.head.appendChild(s);
        })();
      </script>
    </div>
  </div>
  <!-- Fim vídeo -->

  <!-- Botões Cartpanda (YES / NO) -->
  <div id="cartpanda-ocu-buttons" class="btn-wrapper" aria-hidden="true">
    <a href="https://omni-digital.mycartpanda.com/ex-ocu/next-offer/rAYaXldVDK?accepted=yes" class="btn">YES, I WANT IT</a>
    <a href="https://omni-digital.mycartpanda.com/ex-ocu/next-offer/rAYaXldVDK?accepted=no" class="btn btn-no">NO, THANKS</a>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      /* Ajuste aqui o delay desejado em segundos */
      var SECONDS_TO_DISPLAY = 40;

      var buttonsWrapper = document.getElementById('cartpanda-ocu-buttons');
      var alreadyDisplayedKey = 'alreadyCartpandaButtonsDisplayed_' + SECONDS_TO_DISPLAY;
      var alreadyDisplayed = localStorage.getItem(alreadyDisplayedKey);
      var attempts = 0;
      var revealed = false;

      function revealButtons() {
        if (revealed) return;
        revealed = true;
        if (buttonsWrapper) {
          buttonsWrapper.style.display = 'flex';
          buttonsWrapper.setAttribute('aria-hidden', 'false');
          localStorage.setItem(alreadyDisplayedKey, 'true');
        }
      }

      function watchVideoProgress() {
        // Garante que o smartplayer do VTurb esteja carregado
        if (typeof smartplayer === 'undefined' || !(smartplayer.instances && smartplayer.instances.length)) {
          if (attempts >= 15) return;        // limite de tentativas (ajuste se quiser)
          attempts += 1;
          return setTimeout(watchVideoProgress, 800);
        }

        var player = smartplayer.instances[0];
        // Se já exibiu em visita anterior, mostra logo
        if (alreadyDisplayed === 'true') {
          return setTimeout(revealButtons, 100);
        }

        // Observa o progresso
        player.on('timeupdate', function () {
          if (revealed || player.smartAutoPlay) return;  // evita exibir em autoplay forçado
          var current = (player && player.video && player.video.currentTime) ? player.video.currentTime : 0;
          if (current >= SECONDS_TO_DISPLAY) {
            revealButtons();
          }
        });
      }

      watchVideoProgress();
    });
  </script>

</body>
</html>
