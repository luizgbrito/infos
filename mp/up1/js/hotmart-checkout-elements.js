(function(h){typeof define=="function"&&define.amd?define(h):h()})(function(){"use strict";var P=Object.defineProperty;var A=(h,p,u)=>p in h?P(h,p,{enumerable:!0,configurable:!0,writable:!0,value:u}):h[p]=u;var f=(h,p,u)=>(A(h,typeof p!="symbol"?p+"":p,u),u);const h=["overlayCheckout","salesFunnel","inlineCheckout","element:creditCardForm"],p=(m,t)=>{const{id:n,minHeight:s,minWidth:i}=t,e=document.createElement("iframe");return n&&(e.id=n),e.className="custom-element__iframe",e.style.width="100%",e.style.minWidth=i??"320px",e.style.minHeight=s??"300px",e.style.border="0 none",e.style.display="block",e.allow="clipboard-write; payment *",e.src=m,e},u="https://pay.hotmart.com",O="https://pci-pay.hotmart.com";class C{constructor(t,n){f(this,"options",{payment:{},visibilityOptions:{}});f(this,"wrapperElement");f(this,"iframeElement");f(this,"iframeURL",new URL(u));f(this,"iframeOptions",{});this.options=t,console.debug("@@@@ this.options:",this.options);const i={...{elements_document_height_update:e=>{this.iframeElement&&(this.iframeElement.style.height=e)},on_load:()=>{var e,d,c,a,r,o,l,v,b,y,k;this.postMessage({action:"set_data",data:{shopperData:(e=this.options.payment)==null?void 0:e.shopperData,hasErrorCallback:!!((d=this.options.payment)!=null&&d.onError),countryIsoCode:((c=this.options)==null?void 0:c.countryIsoCode)??"",gateways:(o=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:o.gateways,context:(b=(v=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:v.creditCardForm)==null?void 0:b.context}}),(k=(y=this.options)==null?void 0:y.onLoad)==null||k.call(y)}},...n||{}};window.addEventListener("message",e=>{var c;const d=e.source!==((c=this.iframeElement)==null?void 0:c.contentWindow);e.origin!==this.iframeURL.origin||d||(console.debug("@@@@ message:",e),!(!e.data.action||!Object.keys(i).includes(e.data.action))&&i[e.data.action](e.data.data))})}updateOptions(t){this.options={...this.options,...t}}postMessage({action:t,data:n}){var s,i;(i=(s=this.iframeElement)==null?void 0:s.contentWindow)==null||i.postMessage({action:t,data:n},"*")}mount(t){var s;if(this.options.integrationKey&&this.iframeURL.searchParams.append("integrationKey",this.options.integrationKey),this.options.locale&&this.iframeURL.searchParams.append("locale",this.options.locale),this.options.countryIsoCode&&this.iframeURL.searchParams.append("countrycode",this.options.countryIsoCode),this.options.prefilledInfo)for(const[i,e]of Object.entries(this.options.prefilledInfo))this.iframeURL.searchParams.append(i,e);if(this.options.visibilityOptions)for(const[i,e]of Object.entries(this.options.visibilityOptions))this.iframeURL.searchParams.append(i,e);const n=p(this.iframeURL.href,this.iframeOptions);this.iframeElement=n,this.wrapperElement=typeof t=="string"?document.querySelector(t):t,this.wrapperElement&&(this.wrapperElement.innerHTML="",(s=this.wrapperElement)==null||s.appendChild(n),console.debug("@@@@ element mounted successfully"))}}class g extends C{constructor(t,n){const s={on_payment_approve:i=>{var e,d;(d=(e=this.options.payment)==null?void 0:e.onSuccess)==null||d.call(e,i)},on_payment_error:i=>{var e,d;(d=(e=this.options.payment)==null?void 0:e.onError)==null||d.call(e,i)},on_submit_payment:({actionToCall:i})=>{var e,d;this.postMessage({action:"process_payment",data:{shopperData:(e=this.options.payment)==null?void 0:e.shopperData,hasErrorCallback:!!((d=this.options.payment)!=null&&d.onError),actionToCall:i}})},...n||{}};super(t,s),this.iframeURL=new URL(`${u}/elements?off=${this.options.offer}&checkoutMode=2`),this.options.bid=new Date().getTime()}}class x extends g{constructor(t){super(t),console.debug("@@@@ Initializing OverlayCheckout element"),Promise.resolve().then(()=>R).then(n=>{const s=document.createElement("style");s.innerText=n.default,document.head.append(s)})}onKeyUp(t){t.key==="Escape"&&this.destroy()}attach(t){const n=typeof t=="string"?document.querySelector(t):t;t&&(n==null||n.addEventListener("click",s=>{s.preventDefault();const i=document.createElement("div");i.id="custom-element-lightbox-overlay",i.className="custom-element__lightbox-overlay",i.addEventListener("click",()=>{this.destroy()});const e=document.createElement("div");e.id="custom-element-lightbox-modal",e.className="custom-element__lightbox-modal",super.mount(e),document.body.appendChild(i),document.body.appendChild(e)}),document.addEventListener("keyup",s=>this.onKeyUp(s)),console.debug("@@@@ OverlayCheckout attached successfully"))}mount(t){this.attach(t)}destroy(){var t,n;(t=document.getElementById("custom-element-lightbox-overlay"))==null||t.remove(),(n=document.getElementById("custom-element-lightbox-modal"))==null||n.remove()}}class F extends g{constructor(t){super(t),this.iframeURL=new URL(`${u}/funnel${this.getMainPageSearchParams()}`),console.debug("@@@@ Initializing SalesFunnel element")}getMainPageSearchParams(){var t;try{const n=(t=window.top)==null?void 0:t.location,s=window.location,i=(n==null?void 0:n.search)||s.search||"";if(i)return i;const e=n||s;return(e==null?void 0:e.search)||`?${e.toString().split("?")[1]}`}catch{return window.location.search||""}}}class L extends g{constructor(t){super(t),this.iframeURL=new URL(`${u}/elements?off=${this.options.offer}&checkoutMode=2`),console.debug("@@@@ Initializing InlineCheckout element")}}class I extends C{constructor(t){var e,d;const n={on_generate_tokens_intent_success:c=>{var a,r,o,l;(l=(o=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:o.onGenerateTokensSuccess)==null||l.call(o,c)},on_generate_tokens_intent_error:c=>{var a,r,o,l;(l=(o=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:o.onGenerateTokensError)==null||l.call(o,c)},on_credit_card_form_valid:()=>{var c,a,r,o;(o=(r=(a=(c=this.options)==null?void 0:c.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:r.onValidationSuccess)==null||o.call(r)},on_credit_card_form_invalid:c=>{var a,r,o,l;(l=(o=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:o.onValidationError)==null||l.call(o,c)},on_credit_card_form_blur:c=>{var a,r,o,l;(l=(o=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:o.onBlur)==null||l.call(o,c)},on_credit_card_info:c=>{var a,r,o,l;(l=(o=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:o.onCardInfoUpdate)==null||l.call(o,c)}},s=(d=(e=t.elementOptions)==null?void 0:e.creditCardForm)==null?void 0:d.gateways,i=s&&Array.isArray(s)&&s.length?s:["ADYEN","WORLDPAY","DLOCAL","PAYU","EBANX","YUNO"];t.elementOptions={...t.elementOptions,creditCardForm:{...t.elementOptions.creditCardForm,gateways:i}},super(t,n),this.iframeURL=new URL(`${O}/elements/credit-card-form`),this.iframeOptions={minHeight:"0",minWidth:"210px"},console.debug("@@@@ Initializing creditCardForm element")}generateTokens(){this.postMessage({action:"generate_tokens_intent",data:{}}),console.debug("@@@@ tryToGenerateTokens Button triggered")}validateForm(){this.postMessage({action:"validate_intent",data:{}}),console.debug("@@@@ tryToValidateForm Button triggered")}}const _=(m,t={})=>{var e;if(t.off&&(t.offer=t.off),!(t.offer||t.affiliation)&&["overlayCheckout","inlineCheckout"].includes(m))throw new Error("Offer or affiliation must be present");if(m==="element:creditCardForm"&&!((e=t.elementOptions)!=null&&e.creditCardForm.context))throw new Error("Context must be present on credit card form elements options");const i={overlayCheckout:()=>new x(t),inlineCheckout:()=>new L(t),salesFunnel:()=>new F(t),"element:creditCardForm":()=>new I(t)};if(console.debug("@@@@ Initializing Checkout Elements"),!h.includes(m))throw new Error("Element type not available, please check the documentation");return i[m]()},U=10;let w=0;function E(){window.setTimeout(()=>{if(w>=U)return;w+=1;const m=Array.from(document.querySelectorAll("#hotmart-sales-funnel"));if(!m.length){E();return}m.some(t=>t.hasChildNodes())||_("salesFunnel").mount(m[0])},250)}E(),window.checkoutElements={init:_};const R=Object.freeze(Object.defineProperty({__proto__:null,default:".custom-element__iframe{border:none}.custom-element__lightbox-overlay{background-color:#000;position:fixed;width:100%;height:100%;top:0;left:0;opacity:.8}.custom-element__lightbox-modal{position:fixed;width:90%;max-width:90vw;min-height:500px;max-height:90vh;top:5%;left:50%;transform:translate(-50%);overflow:scroll}"},Symbol.toStringTag,{value:"Module"}))});
